#include "subpixel_max.hpp"

using namespace emida;

const double* emida::get_lstsq_matrix(int s)
{
	switch (s)
	{
	case 3:
		return lstsq_matrix<double, 3>::mat.data();
	case 5:
		return lstsq_matrix<double, 5>::mat.data();
	case 7:
		return lstsq_matrix<double, 7>::mat.data();
	case 9:
		return lstsq_matrix<double, 9>::mat.data();
	default:
		throw std::runtime_error("Wrong fitting size.");
	}
}

template<>
const std::array<double, 6 * 3 * 3> lstsq_matrix<double,3>::mat{
 58.0/72, 16.0/72, -2.0/72, 16.0/72, -8.0/72, -8.0/72, -2.0/72, -8.0/72, 10.0/72,
-3.0/4, 2.0/3, 6.0/72, -1.0/2, 2.0/3, -12.0/72, -1.0/4, 2.0/3, -30.0/72,
-3.0/4, -1.0/2, -1.0/4, 2.0/3, 2.0/3, 2.0/3, 6.0/72, -12.0/72, -30.0/72,
12.0/72, -1.0/3, 1.0/6, 1.0/6, -1.0/3, 1.0/6, 1.0/6, -1.0/3, 1.0/6,
1.0/4, 0, -1.0/4, 0, 0, 0, -1.0/4, 0, 1.0/4,
1.0/6, 1.0/6, 1.0/6, -1.0/3, -1.0/3, -1.0/3, 1.0/6, 1.0/6, 1.0/6 };

template<>
const std::array<double, 6 * 5 * 5> lstsq_matrix<double, 5>::mat{
332.0/700, 188.0/700, 84.0/700, 20.0/700, -4.0/700, 188.0/700, 72.0/700, -4.0/700, -40.0/700, -36.0/700, 84.0/700, -4.0/700, -52.0/700, -60.0/700, -28.0/700, 20.0/700, -40.0/700, -60.0/700, -40.0/700, 20.0/700, -4.0/700, -36.0/700, -28.0/700, 20.0/700, 108.0/700,
-164.0/700, -2.0/700, 80.0/700, 82.0/700, 4.0/700, -136.0/700, 12.0/700, 80.0/700, 68.0/700, -24.0/700, -108.0/700, 26.0/700, 80.0/700, 54.0/700, -52.0/700, -80.0/700, 40.0/700, 80.0/700, 40.0/700, -80.0/700, -52.0/700, 54.0/700, 80.0/700, 26.0/700, -108.0/700,
-164.0/700, -136.0/700, -108.0/700, -80.0/700, -52.0/700, -2.0/700, 12.0/700, 26.0/700, 40.0/700, 54.0/700, 80.0/700, 80.0/700, 80.0/700, 80.0/700, 80.0/700, 82.0/700, 68.0/700, 54.0/700, 40.0/700, 26.0/700, 4.0/700, -24.0/700, -52.0/700, -80.0/700, -108.0/700,
20.0/700, -10.0/700, -20.0/700, -10.0/700, 20.0/700, 20.0/700, -10.0/700, -20.0/700, -10.0/700, 20.0/700, 20.0/700, -10.0/700, -20.0/700, -10.0/700, 20.0/700, 20.0/700, -10.0/700, -20.0/700, -10.0/700, 20.0/700, 20.0/700, -10.0/700, -20.0/700, -10.0/700, 20.0/700,
28.0/700, 14.0/700, -0.0/700, -14.0/700, -28.0/700, 14.0/700, 7.0/700, -0.0/700, -7.0/700, -14.0/700, 0.0/700, 0.0/700, -0.0/700, 0.0/700, 0.0/700, -14.0/700, -7.0/700, -0.0/700, 7.0/700, 14.0/700, -28.0/700, -14.0/700, -0.0/700, 14.0/700, 28.0/700,
20.0/700, 20.0/700, 20.0/700, 20.0/700, 20.0/700, -10.0/700, -10.0/700, -10.0/700, -10.0/700, -10.0/700, -20.0/700, -20.0/700, -20.0/700, -20.0/700, -20.0/700, -10.0/700, -10.0/700, -10.0/700, -10.0/700, -10.0/700, 20.0/700, 20.0/700, 20.0/700, 20.0/700, 20.0/700 };

template<>
const std::array<double, 6 * 7 * 7> lstsq_matrix<double, 7>::mat{
2121.0/7056, 1470.0/7056, 939.0/7056, 528.0/7056, 237.0/7056, 66.0/7056, 15.0/7056, 1470.0/7056, 900.0/7056, 450.0/7056, 120.0/7056, -90.0/7056, -180.0/7056, -150.0/7056, 939.0/7056, 450.0/7056, 81.0/7056, -168.0/7056, -297.0/7056, -306.0/7056, -195.0/7056, 528.0/7056, 120.0/7056, -168.0/7056, -336.0/7056, -384.0/7056, -312.0/7056, -120.0/7056, 237.0/7056, -90.0/7056, -297.0/7056, -384.0/7056, -351.0/7056, -198.0/7056, 75.0/7056, 66.0/7056, -180.0/7056, -306.0/7056, -312.0/7056, -198.0/7056, 36.0/7056, 390.0/7056, 15.0/7056, -150.0/7056, -195.0/7056, -120.0/7056, 75.0/7056, 390.0/7056, 825.0/7056,
-711.0/7056, -234.0/7056, 99.0/7056, 288.0/7056, 333.0/7056, 234.0/7056, -9.0/7056, -630.0/7056, -180.0/7056, 126.0/7056, 288.0/7056, 306.0/7056, 180.0/7056, -90.0/7056, -549.0/7056, -126.0/7056, 153.0/7056, 288.0/7056, 279.0/7056, 126.0/7056, -171.0/7056, -468.0/7056, -72.0/7056, 180.0/7056, 288.0/7056, 252.0/7056, 72.0/7056, -252.0/7056, -387.0/7056, -18.0/7056, 207.0/7056, 288.0/7056, 225.0/7056, 18.0/7056, -333.0/7056, -306.0/7056, 36.0/7056, 234.0/7056, 288.0/7056, 198.0/7056, -36.0/7056, -414.0/7056, -225.0/7056, 90.0/7056, 261.0/7056, 288.0/7056, 171.0/7056, -90.0/7056, -495.0/7056,
-711.0/7056, -630.0/7056, -549.0/7056, -468.0/7056, -387.0/7056, -306.0/7056, -225.0/7056, -234.0/7056, -180.0/7056, -126.0/7056, -72.0/7056, -18.0/7056, 36.0/7056, 90.0/7056, 99.0/7056, 126.0/7056, 153.0/7056, 180.0/7056, 207.0/7056, 234.0/7056, 261.0/7056, 288.0/7056, 288.0/7056, 288.0/7056, 288.0/7056, 288.0/7056, 288.0/7056, 288.0/7056, 333.0/7056, 306.0/7056, 279.0/7056, 252.0/7056, 225.0/7056, 198.0/7056, 171.0/7056, 234.0/7056, 180.0/7056, 126.0/7056, 72.0/7056, 18.0/7056, -36.0/7056, -90.0/7056, -9.0/7056, -90.0/7056, -171.0/7056, -252.0/7056, -333.0/7056, -414.0/7056, -495.0/7056,
60.0/7056, 0.0/7056, -36.0/7056, -48.0/7056, -36.0/7056, -0.0/7056, 60.0/7056, 60.0/7056, -0.0/7056, -36.0/7056, -48.0/7056, -36.0/7056, -0.0/7056, 60.0/7056, 60.0/7056, -0.0/7056, -36.0/7056, -48.0/7056, -36.0/7056, -0.0/7056, 60.0/7056, 60.0/7056, -0.0/7056, -36.0/7056, -48.0/7056, -36.0/7056, 0.0/7056, 60.0/7056, 60.0/7056, -0.0/7056, -36.0/7056, -48.0/7056, -36.0/7056, 0.0/7056, 60.0/7056, 60.0/7056, -0.0/7056, -36.0/7056, -48.0/7056, -36.0/7056, 0.0/7056, 60.0/7056, 60.0/7056, -0.0/7056, -36.0/7056, -48.0/7056, -36.0/7056, 0.0/7056, 60.0/7056,
81.0/7056, 54.0/7056, 27.0/7056, -0.0/7056, -27.0/7056, -54.0/7056, -81.0/7056, 54.0/7056, 36.0/7056, 18.0/7056, -0.0/7056, -18.0/7056, -36.0/7056, -54.0/7056, 27.0/7056, 18.0/7056, 9.0/7056, 0.0/7056, -9.0/7056, -18.0/7056, -27.0/7056, 0.0/7056, 0.0/7056, 0.0/7056, 0.0/7056, 0.0/7056, 0.0/7056, 0.0/7056, -27.0/7056, -18.0/7056, -9.0/7056, 0.0/7056, 9.0/7056, 18.0/7056, 27.0/7056, -54.0/7056, -36.0/7056, -18.0/7056, 0.0/7056, 18.0/7056, 36.0/7056, 54.0/7056, -81.0/7056, -54.0/7056, -27.0/7056, -0.0/7056, 27.0/7056, 54.0/7056, 81.0/7056,
60.0/7056, 60.0/7056, 60.0/7056, 60.0/7056, 60.0/7056, 60.0/7056, 60.0/7056, -0.0/7056, -0.0/7056, -0.0/7056, -0.0/7056, -0.0/7056, 0.0/7056, 0.0/7056, -36.0/7056, -36.0/7056, -36.0/7056, -36.0/7056, -36.0/7056, -36.0/7056, -36.0/7056, -48.0/7056, -48.0/7056, -48.0/7056, -48.0/7056, -48.0/7056, -48.0/7056, -48.0/7056, -36.0/7056, -36.0/7056, -36.0/7056, -36.0/7056, -36.0/7056, -36.0/7056, -36.0/7056, 0.0/7056, 0.0/7056, 0.0/7056, 0.0/7056, 0.0/7056, 0.0/7056, -0.0/7056, 60.0/7056, 60.0/7056, 60.0/7056, 60.0/7056, 60.0/7056, 60.0/7056, 60.0/7056
};

template<>
const std::array<double, 6 * 9 * 9> lstsq_matrix<double, 9>::mat{
2564240.0/12474000, 1956080.0/12474000, 1431920.0/12474000, 991760.0/12474000, 635600.0/12474000, 363440.0/12474000, 175280.0/12474000, 71120.0/12474000, 50960.0/12474000, 1956080.0/12474000, 1403360.0/12474000, 934640.0/12474000, 549920.0/12474000, 249200.0/12474000, 32480.0/12474000, -100240.0/12474000, -148960.0/12474000, -113680.0/12474000, 1431920.0/12474000, 934640.0/12474000, 521360.0/12474000, 192080.0/12474000, -53200.0/12474000, -214480.0/12474000, -291760.0/12474000, -285040.0/12474000, -194320.0/12474000, 991760.0/12474000, 549920.0/12474000, 192080.0/12474000, -81760.0/12474000, -271600.0/12474000, -377440.0/12474000, -399280.0/12474000, -337120.0/12474000, -190960.0/12474000, 635600.0/12474000, 249200.0/12474000, -53200.0/12474000, -271600.0/12474000, -406000.0/12474000, -456400.0/12474000, -422800.0/12474000, -305200.0/12474000, -103600.0/12474000, 363440.0/12474000, 32480.0/12474000, -214480.0/12474000, -377440.0/12474000, -456400.0/12474000, -451360.0/12474000, -362320.0/12474000, -189280.0/12474000, 67760.0/12474000, 175280.0/12474000, -100240.0/12474000, -291760.0/12474000, -399280.0/12474000, -422800.0/12474000, -362320.0/12474000, -217840.0/12474000, 10640.0/12474000, 323120.0/12474000, 71120.0/12474000, -148960.0/12474000, -285040.0/12474000, -337120.0/12474000, -305200.0/12474000, -189280.0/12474000, 10640.0/12474000, 294560.0/12474000, 662480.0/12474000, 50960.0/12474000, -113680.0/12474000, -194320.0/12474000, -190960.0/12474000, -103600.0/12474000, 67760.0/12474000, 323120.0/12474000, 662480.0/12474000, 1085840.0/12474000,
-650160.0/12474000, -319620.0/12474000, -61080.0/12474000, 125460.0/12474000, 240000.0/12474000, 282540.0/12474000, 253080.0/12474000, 151620.0/12474000, -21840.0/12474000, -594720.0/12474000, -278040.0/12474000, -33360.0/12474000, 139320.0/12474000, 240000.0/12474000, 268680.0/12474000, 225360.0/12474000, 110040.0/12474000, -77280.0/12474000, -539280.0/12474000, -236460.0/12474000, -5640.0/12474000, 153180.0/12474000, 240000.0/12474000, 254820.0/12474000, 197640.0/12474000, 68460.0/12474000, -132720.0/12474000, -483840.0/12474000, -194880.0/12474000, 22080.0/12474000, 167040.0/12474000, 240000.0/12474000, 240960.0/12474000, 169920.0/12474000, 26880.0/12474000, -188160.0/12474000, -428400.0/12474000, -153300.0/12474000, 49800.0/12474000, 180900.0/12474000, 240000.0/12474000, 227100.0/12474000, 142200.0/12474000, -14700.0/12474000, -243600.0/12474000, -372960.0/12474000, -111720.0/12474000, 77520.0/12474000, 194760.0/12474000, 240000.0/12474000, 213240.0/12474000, 114480.0/12474000, -56280.0/12474000, -299040.0/12474000, -317520.0/12474000, -70140.0/12474000, 105240.0/12474000, 208620.0/12474000, 240000.0/12474000, 199380.0/12474000, 86760.0/12474000, -97860.0/12474000, -354480.0/12474000, -262080.0/12474000, -28560.0/12474000, 132960.0/12474000, 222480.0/12474000, 240000.0/12474000, 185520.0/12474000, 59040.0/12474000, -139440.0/12474000, -409920.0/12474000, -206640.0/12474000, 13020.0/12474000, 160680.0/12474000, 236340.0/12474000, 240000.0/12474000, 171660.0/12474000, 31320.0/12474000, -181020.0/12474000, -465360.0/12474000,
-650160.0/12474000, -594720.0/12474000, -539280.0/12474000, -483840.0/12474000, -428400.0/12474000, -372960.0/12474000, -317520.0/12474000, -262080.0/12474000, -206640.0/12474000, -319620.0/12474000, -278040.0/12474000, -236460.0/12474000, -194880.0/12474000, -153300.0/12474000, -111720.0/12474000, -70140.0/12474000, -28560.0/12474000, 13020.0/12474000, -61080.0/12474000, -33360.0/12474000, -5640.0/12474000, 22080.0/12474000, 49800.0/12474000, 77520.0/12474000, 105240.0/12474000, 132960.0/12474000, 160680.0/12474000, 125460.0/12474000, 139320.0/12474000, 153180.0/12474000, 167040.0/12474000, 180900.0/12474000, 194760.0/12474000, 208620.0/12474000, 222480.0/12474000, 236340.0/12474000, 240000.0/12474000, 240000.0/12474000, 240000.0/12474000, 240000.0/12474000, 240000.0/12474000, 240000.0/12474000, 240000.0/12474000, 240000.0/12474000, 240000.0/12474000, 282540.0/12474000, 268680.0/12474000, 254820.0/12474000, 240960.0/12474000, 227100.0/12474000, 213240.0/12474000, 199380.0/12474000, 185520.0/12474000, 171660.0/12474000, 253080.0/12474000, 225360.0/12474000, 197640.0/12474000, 169920.0/12474000, 142200.0/12474000, 114480.0/12474000, 86760.0/12474000, 59040.0/12474000, 31320.0/12474000, 151620.0/12474000, 110040.0/12474000, 68460.0/12474000, 26880.0/12474000, -14700.0/12474000, -56280.0/12474000, -97860.0/12474000, -139440.0/12474000, -181020.0/12474000, -21840.0/12474000, -77280.0/12474000, -132720.0/12474000, -188160.0/12474000, -243600.0/12474000, -299040.0/12474000, -354480.0/12474000, -409920.0/12474000, -465360.0/12474000,
42000.0/12474000, 10500.0/12474000, -12000.0/12474000, -25500.0/12474000, -30000.0/12474000, -25500.0/12474000, -12000.0/12474000, 10500.0/12474000, 42000.0/12474000, 42000.0/12474000, 10500.0/12474000, -12000.0/12474000, -25500.0/12474000, -30000.0/12474000, -25500.0/12474000, -12000.0/12474000, 10500.0/12474000, 42000.0/12474000, 42000.0/12474000, 10500.0/12474000, -12000.0/12474000, -25500.0/12474000, -30000.0/12474000, -25500.0/12474000, -12000.0/12474000, 10500.0/12474000, 42000.0/12474000, 42000.0/12474000, 10500.0/12474000, -12000.0/12474000, -25500.0/12474000, -30000.0/12474000, -25500.0/12474000, -12000.0/12474000, 10500.0/12474000, 42000.0/12474000, 42000.0/12474000, 10500.0/12474000, -12000.0/12474000, -25500.0/12474000, -30000.0/12474000, -25500.0/12474000, -12000.0/12474000, 10500.0/12474000, 42000.0/12474000, 42000.0/12474000, 10500.0/12474000, -12000.0/12474000, -25500.0/12474000, -30000.0/12474000, -25500.0/12474000, -12000.0/12474000, 10500.0/12474000, 42000.0/12474000, 42000.0/12474000, 10500.0/12474000, -12000.0/12474000, -25500.0/12474000, -30000.0/12474000, -25500.0/12474000, -12000.0/12474000, 10500.0/12474000, 42000.0/12474000, 42000.0/12474000, 10500.0/12474000, -12000.0/12474000, -25500.0/12474000, -30000.0/12474000, -25500.0/12474000, -12000.0/12474000, 10500.0/12474000, 42000.0/12474000, 42000.0/12474000, 10500.0/12474000, -12000.0/12474000, -25500.0/12474000, -30000.0/12474000, -25500.0/12474000, -12000.0/12474000, 10500.0/12474000, 42000.0/12474000,
55440.0/12474000, 41580.0/12474000, 27720.0/12474000, 13860.0/12474000, -0.0/12474000, -13860.0/12474000, -27720.0/12474000, -41580.0/12474000, -55440.0/12474000, 41580.0/12474000, 31185.0/12474000, 20790.0/12474000, 10395.0/12474000, 0.0/12474000, -10395.0/12474000, -20790.0/12474000, -31185.0/12474000, -41580.0/12474000, 27720.0/12474000, 20790.0/12474000, 13860.0/12474000, 6930.0/12474000, 0.0/12474000, -6930.0/12474000, -13860.0/12474000, -20790.0/12474000, -27720.0/12474000, 13860.0/12474000, 10395.0/12474000, 6930.0/12474000, 3465.0/12474000, 0.0/12474000, -3465.0/12474000, -6930.0/12474000, -10395.0/12474000, -13860.0/12474000, -0.0/12474000, 0.0/12474000, 0.0/12474000, 0.0/12474000, 0.0/12474000, 0.0/12474000, 0.0/12474000, 0.0/12474000, -0.0/12474000, -13860.0/12474000, -10395.0/12474000, -6930.0/12474000, -3465.0/12474000, 0.0/12474000, 3465.0/12474000, 6930.0/12474000, 10395.0/12474000, 13860.0/12474000, -27720.0/12474000, -20790.0/12474000, -13860.0/12474000, -6930.0/12474000, 0.0/12474000, 6930.0/12474000, 13860.0/12474000, 20790.0/12474000, 27720.0/12474000, -41580.0/12474000, -31185.0/12474000, -20790.0/12474000, -10395.0/12474000, 0.0/12474000, 10395.0/12474000, 20790.0/12474000, 31185.0/12474000, 41580.0/12474000, -55440.0/12474000, -41580.0/12474000, -27720.0/12474000, -13860.0/12474000, -0.0/12474000, 13860.0/12474000, 27720.0/12474000, 41580.0/12474000, 55440.0/12474000,
42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -30000.0/12474000, -30000.0/12474000, -30000.0/12474000, -30000.0/12474000, -30000.0/12474000, -30000.0/12474000, -30000.0/12474000, -30000.0/12474000, -30000.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -25500.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, -12000.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 10500.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000, 42000.0/12474000
};
